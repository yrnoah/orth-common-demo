{"version":3,"file":"Collapse.stories-03f118b4.js","sources":["../../../paas-library/src/Collapse/useCollapse.ts","../../../paas-library/src/Collapse/Collapse.tsx"],"sourcesContent":["import { useState, useCallback } from \"react\";\nimport { useMeasure, useUpdateEffect } from \"react-use\";\nimport { useSpring } from \"@react-spring/web\";\nimport { createContainer } from \"unstated-next\";\n\n// export const animationStageDuration = 400;\n\ninterface InitialCollapse {\n  open?: boolean;\n  defaultOpen?: boolean;\n}\n\nfunction useCollapseStage(\n  initialState: InitialCollapse = { open: undefined, defaultOpen: true }\n) {\n  const [_open, setOpen] = useState(() => {\n    if (typeof initialState.open === \"boolean\") return initialState.open;\n    return !!initialState.defaultOpen;\n  });\n  const [finishedCounts, setFinished] = useState(0);\n  const _setOpen = useCallback(\n    (value: React.SetStateAction<boolean>) => setOpen(value),\n    []\n  );\n  const [headerRef, { height: headerHeight }] = useMeasure();\n  const [contentRef, { height: contentHeight }] = useMeasure();\n  const initialed = !!headerHeight && !!contentHeight;\n\n  // animations\n  const [wrapperAnimation, collapseAnimAPI] = useSpring(\n    () => ({\n      to: { height: 0 },\n      onRest: (event) => {\n        if (event.finished === true) {\n          setFinished((v) => v + 1);\n        }\n      },\n    }),\n    []\n  );\n  // init animation value\n  useUpdateEffect(() => {\n    if (initialed) {\n      collapseAnimAPI.set({\n        height: _open ? headerHeight + contentHeight : headerHeight,\n      });\n    }\n  }, [initialed]);\n  const toggle = useCallback(() => setOpen((v) => !v), []);\n  const onOpen = useCallback(() => setOpen(true), []);\n  const onClose = useCallback(() => setOpen(false), []);\n  return {\n    isOpen: _open,\n    setOpen: _setOpen,\n    headerRef,\n    contentRef,\n    collapseAnimAPI,\n    wrapperAnimation,\n    toggle,\n    onOpen,\n    onClose,\n    initialed,\n    headerHeight,\n    contentHeight,\n    finishedCounts,\n  } as const;\n}\n\nconst container = createContainer(useCollapseStage);\n\nexport const CollapseProvider = container.Provider;\n\nexport const useCollapse = container.useContainer;\n\nexport default container;\n","import { memo, forwardRef, useMemo, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { animated } from \"@react-spring/web\";\nimport { CollapseProvider, useCollapse } from \"./useCollapse\";\n\nexport interface CollapseProps\n  extends Omit<\n    React.HTMLAttributes<HTMLDivElement>,\n    \"title\" | \"style\" | \"onClick\"\n  > {\n  /**\n   * @default: undefined\n   * @description if provided, controlled by open\n   */\n  open?: boolean;\n  /**\n   * @default: true\n   * @description if open provided, controlled by open\n   */\n  defaultOpen?: boolean;\n  /** @description title component  */\n  title: React.ReactNode;\n  /** @description collapse content */\n  children: React.ReactNode;\n  /** @description extra content will be put into wrapper */\n  extraNode?: React.ReactNode;\n  /** @description styles for header wrapper */\n  headerStyles?: React.CSSProperties;\n  /**\n   * @description styles for content wrapper\n   * @note do not set margin and padding, browser won't count these values and will cause Collapse height error.\n   */\n  contentStyles?: Omit<\n    React.CSSProperties,\n    | \"padding\"\n    | \"paddingTop\"\n    | \"paddingBottom\"\n    | \"margin\"\n    | \"marginTop\"\n    | \"marginBottom\"\n  >;\n  /** @default false */\n  disableHeaderToggle?: boolean;\n}\n\nexport const Collapse = forwardRef<HTMLDivElement, CollapseProps>(\n  ({ defaultOpen = true, ...props }, ref) => {\n    return (\n      <CollapseProvider\n        initialState={{ open: props.open, defaultOpen: defaultOpen }}\n      >\n        <CollapseContent {...props} defaultOpen={defaultOpen} ref={ref} />\n      </CollapseProvider>\n    );\n  }\n);\nexport const CollapseContent = forwardRef<HTMLDivElement, CollapseProps>(\n  (props, ref) => {\n    const {\n      title,\n      headerStyles,\n      contentStyles,\n      children,\n      extraNode,\n      disableHeaderToggle,\n      open: propsOpen,\n      defaultOpen,\n      ...rest\n    } = props;\n    const {\n      isOpen,\n      collapseAnimAPI,\n      wrapperAnimation,\n      toggle,\n      headerRef,\n      contentRef,\n      initialed,\n      headerHeight,\n      contentHeight,\n    } = useCollapse();\n    const open = typeof propsOpen === \"boolean\" ? propsOpen : isOpen;\n    // styles\n    const contentStyle = useMemo(() => {\n      if (!headerHeight || !contentHeight)\n        return {\n          opacity: 0,\n          pointerEvents: \"none\",\n        } satisfies React.CSSProperties;\n      const s: React.CSSProperties = contentStyles || {};\n      return { ...s, top: headerHeight };\n    }, [contentStyles, headerHeight, contentHeight]);\n    const style = initialed ? wrapperAnimation : undefined;\n    // update by content change & open status\n    useEffect(() => {\n      if (!initialed) return;\n      const toHeight = open ? headerHeight + contentHeight : headerHeight;\n      collapseAnimAPI.start({ to: { height: toHeight } });\n    }, [initialed, headerHeight, contentHeight, collapseAnimAPI, open]);\n    return (\n      <Wrapper {...rest} ref={ref} style={style}>\n        {/* absolute content */}\n        <ContentWrapper\n          ref={(element) => element && contentRef(element)}\n          style={contentStyle}\n        >\n          {children}\n        </ContentWrapper>\n        {extraNode}\n        {/* header */}\n        <HeaderWrapper\n          ref={(element) => element && headerRef(element)}\n          style={headerStyles}\n          onClick={disableHeaderToggle ? undefined : toggle}\n        >\n          {title}\n        </HeaderWrapper>\n      </Wrapper>\n    );\n  }\n);\n\nexport default memo(Collapse);\n\nexport const Wrapper = styled(animated.div)`\n  position: relative;\n  overflow: hidden;\n`;\n\nexport const HeaderWrapper = styled.div`\n  ${(p) => p.theme.flexCSS.row}\n  align-items: center;\n  position: relative;\n`;\n\nexport const ContentWrapper = styled(animated.div)`\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n`;\n"],"names":["useCollapseStage","initialState","open","undefined","defaultOpen","_open","setOpen","useState","finishedCounts","setFinished","_setOpen","useCallback","value","headerRef","height","headerHeight","useMeasure","contentRef","contentHeight","initialed","wrapperAnimation","collapseAnimAPI","useSpring","to","onRest","event","finished","v","useUpdateEffect","set","toggle","onOpen","onClose","isOpen","container","createContainer","CollapseProvider","Provider","useCollapse","useContainer","Collapse","forwardRef","props","ref","jsx","CollapseContent","title","headerStyles","contentStyles","children","extraNode","disableHeaderToggle","propsOpen","rest","contentStyle","useMemo","s","style","useEffect","toHeight","jsxs","Wrapper","ContentWrapper","element","Collapse$2","memo","styled","animated","HeaderWrapper","div"],"mappings":"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"}