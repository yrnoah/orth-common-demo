{"version":3,"file":"Drawer.stories-fa49307a.js","sources":["../../../paas-library/src/Drawer/store.ts","../../../paas-library/src/Drawer/Drawer.tsx"],"sourcesContent":["import { useState, useCallback, useEffect } from \"react\";\nimport { createContainer } from \"unstated-next\";\nimport useCurrent from \"../hooks/useCurrent\";\n\nexport type AnimationStage =\n  | \"entering\"\n  | \"entered\"\n  | \"leaving\"\n  // | \"leaved\"\n  | \"none\";\n\nexport type DrawerInitialState = {\n  duration: number;\n  initialStage: AnimationStage;\n  onStageChange?: (currentStage: AnimationStage) => void;\n};\n\nexport const animationStageDuration = 400;\n\nfunction useDrawer(\n  initialState: DrawerInitialState = {\n    duration: animationStageDuration,\n    initialStage: \"none\",\n  }\n) {\n  const [animatingStage, setAnimatingStage] = useState<AnimationStage>(\n    initialState.initialStage\n  );\n  const callback = useCurrent(initialState.onStageChange);\n  useEffect(() => {\n    // leaving -> none\n    if (animatingStage === \"leaving\") {\n      const timer = setTimeout(() => {\n        setAnimatingStage(\"none\");\n      }, initialState.duration);\n      return () => clearTimeout(timer);\n    }\n    // entering -> entered\n    if (animatingStage === \"entering\") {\n      const timer = setTimeout(() => {\n        setAnimatingStage((pre) => (pre === \"entering\" ? \"entered\" : pre));\n      }, initialState.duration);\n      return () => clearTimeout(timer);\n    }\n    if (callback.current) callback.current(animatingStage);\n  }, [animatingStage, callback, initialState.duration]);\n  const onSetAnimatingStage = useCallback(\n    (v: React.SetStateAction<AnimationStage>) => {\n      if (typeof v === \"function\") {\n        return setAnimatingStage(v);\n      }\n      setAnimatingStage((pre) => {\n        if (pre === \"none\" && v === \"leaving\") return \"none\";\n        return v;\n      });\n    },\n    []\n  );\n  return { animatingStage, onSetAnimatingStage } as const;\n}\n\nconst container = createContainer(useDrawer);\n\nexport const DrawerStageProvider = container.Provider;\n\nexport const useDrawerStage = container.useContainer;\n\nexport default container;\n","import { memo, forwardRef, useImperativeHandle } from \"react\";\nimport styled, { css, keyframes } from \"styled-components\";\nimport { Portal } from \"../Siblings\";\nimport { drawerPortalID } from \"../Siblings/portalID\";\nimport {\n  DrawerStageProvider,\n  useDrawerStage,\n  animationStageDuration,\n  type AnimationStage,\n} from \"./store\";\n\nexport type DrawerAPI = {\n  open: () => void;\n  close: () => void;\n  toggle: () => boolean;\n};\n\nexport type DrawerPosition = \"right\" | \"left\" | \"top\" | \"bottom\";\n\nexport interface DrawerProps {\n  children: React.ReactNode;\n  /**\n   * @description when position is right or left -> drawer width; when position is top or bottom -> drawer height\n   * @default max-content\n   */\n  size: string | number;\n  /** @description wrapper styles */\n  wrapperStyles?: React.CSSProperties;\n  /**\n   * @description millionSeconds duration for animation\n   * @default 400\n   */\n  duration?: number;\n  /**\n   * @default none\n   * @value entered = default open\n   */\n  initialStage?: AnimationStage;\n  onStageChange?: (currentStage: AnimationStage) => void;\n  /** @default right */\n  position?: DrawerPosition;\n  /** @default \"orthogonal-drawer\" */\n  portalID?: string;\n}\n\nconst Drawer = forwardRef((props: DrawerProps, ref) => {\n  if (!props.children) {\n    throw new Error(\"Please set drawer content.\");\n  }\n  return (\n    <DrawerStageProvider\n      initialState={{\n        duration: props?.duration || animationStageDuration,\n        initialStage: props.initialStage || \"none\",\n        onStageChange: props.onStageChange,\n      }}\n    >\n      <DrawerContent {...props} ref={ref} />\n    </DrawerStageProvider>\n  );\n});\nconst DrawerContent = forwardRef((props: DrawerProps, ref) => {\n  const {\n    size = \"max-content\",\n    children,\n    wrapperStyles,\n    duration,\n    position = \"right\",\n    portalID = drawerPortalID,\n  } = props;\n  const { onSetAnimatingStage, animatingStage } = useDrawerStage();\n  const isOpen = animatingStage !== \"none\";\n  const isHorizontal = position === \"right\" || position === \"left\";\n  const width = isHorizontal ? size : undefined;\n  const height = isHorizontal ? undefined : size;\n  const active = animatingStage === \"entering\" || animatingStage === \"entered\";\n  useImperativeHandle(\n    ref,\n    () => {\n      return {\n        open() {\n          onSetAnimatingStage(\"entering\");\n        },\n        close() {\n          onSetAnimatingStage(\"leaving\");\n        },\n        /** @return toOpen */\n        toggle(): boolean {\n          let toOpen: boolean = false;\n          let toState = animatingStage;\n          switch (animatingStage) {\n            default:\n            case \"entering\":\n            case \"entered\":\n              toState = \"leaving\";\n              break;\n            case \"leaving\":\n            case \"none\":\n              toOpen = true;\n              toState = \"entering\";\n              break;\n          }\n          onSetAnimatingStage(toState);\n          return toOpen;\n        },\n      } as const;\n    },\n    [onSetAnimatingStage, animatingStage]\n  );\n  if (!isOpen) return null;\n  if (isHorizontal && !(size || wrapperStyles?.width)) return null;\n  if (!isHorizontal && !(size || wrapperStyles?.height)) return null;\n  return (\n    <Portal id={portalID}>\n      <Wrapper\n        style={{ ...(wrapperStyles || {}), width, height }}\n        position={position}\n        duration={duration || animationStageDuration}\n        active={active}\n      >\n        {children}\n      </Wrapper>\n    </Portal>\n  );\n});\n\nexport default memo(Drawer);\n\nconst showFromRight = keyframes`\n  0% { transform: translateX(100%) }\n  100% { transform: translateX(0) }\n`;\nconst showFromLeft = keyframes`\n  0% { transform: translateX(-100%) }\n  100% { transform: translateX(0) }\n`;\nconst showFromTop = keyframes`\n  0% { transform: translateY(-100%) }\n  100% { transform: translateY(0) }\n`;\nconst showFromBottom = keyframes`\n  0% { transform: translateY(100%) }\n  100% { transform: translateY(0) }\n`;\n\nconst Wrapper = styled.div<{\n  active: boolean;\n  duration: number;\n  position: DrawerPosition;\n}>`\n  position: fixed;\n  overflow: hidden;\n  transition: transform ${(p) => p.duration}ms ease;\n  box-shadow: 0 0 20px 0 #0000000d;\n\n  ${({ position, duration }) => {\n    if (position === \"right\") {\n      return css`\n        top: 0;\n        right: 0;\n        bottom: 0;\n        animation: ${showFromRight} ${duration}ms ease;\n      `;\n    }\n    if (position === \"left\") {\n      return css`\n        top: 0;\n        left: 0;\n        bottom: 0;\n        animation: ${showFromLeft} ${duration}ms ease;\n      `;\n    }\n    if (position === \"top\") {\n      return css`\n        left: 0;\n        right: 0;\n        top: 0;\n        animation: ${showFromTop} ${duration}ms ease;\n      `;\n    }\n    if (position === \"bottom\") {\n      return css`\n        left: 0;\n        right: 0;\n        bottom: 0;\n        animation: ${showFromBottom} ${duration}ms ease;\n      `;\n    }\n    return undefined;\n  }}\n\n  ${({ active }) => {\n    if (active) {\n      return css`\n        pointer-events: auto;\n      `;\n    }\n    return css`\n      pointer-events: none;\n      animation: none;\n    `;\n  }}\n\n  ${({ active, position }) => {\n    // position right\n    if (position === \"right\" && active) {\n      return css`\n        transform: translateX(0);\n      `;\n    }\n    if (position === \"right\" && !active) {\n      return css`\n        transform: translateX(100%);\n      `;\n    }\n    // position left\n    if (position === \"left\" && active) {\n      return css`\n        transform: translateX(0);\n      `;\n    }\n    if (position === \"left\" && !active) {\n      return css`\n        transform: translateX(-100%);\n      `;\n    }\n    // position top\n    if (position === \"top\" && active) {\n      return css`\n        transform: translateY(0);\n      `;\n    }\n    if (position === \"top\" && !active) {\n      return css`\n        transform: translateY(-100%);\n      `;\n    }\n    // position bottom\n    if (position === \"bottom\" && active) {\n      return css`\n        transform: translateY(0);\n      `;\n    }\n    if (position === \"bottom\" && !active) {\n      return css`\n        transform: translateY(100%);\n      `;\n    }\n    return undefined;\n  }}\n`;\n"],"names":["animationStageDuration","useDrawer","initialState","animatingStage","setAnimatingStage","useState","callback","useCurrent","useEffect","timer","pre","onSetAnimatingStage","useCallback","v","container","createContainer","DrawerStageProvider","useDrawerStage","Drawer","forwardRef","props","ref","jsx","DrawerContent","size","children","wrapperStyles","duration","position","portalID","drawerPortalID","isOpen","isHorizontal","width","height","active","useImperativeHandle","toOpen","toState","Portal","Wrapper","Drawer$2","memo","showFromRight","keyframes","showFromLeft","showFromTop","showFromBottom","styled","p","css"],"mappings":"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"}