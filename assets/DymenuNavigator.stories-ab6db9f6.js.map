{"version":3,"file":"DymenuNavigator.stories-ab6db9f6.js","sources":["../../../../node_modules/react-use/esm/useWindowSize.js","../../../paas-library/src/DynamicMenu/components/AnimatedTextButton.tsx","../../../paas-library/src/DynamicMenu/hooks/useDymenuCenter.ts","../../../paas-library/src/DynamicMenu/hooks/useAutoSize.ts","../../../paas-library/src/DynamicMenu/hooks/useScaleToElement.ts","../../../paas-library/src/DynamicMenu/presets/DymenuNavigator.tsx"],"sourcesContent":["import { useEffect } from 'react';\nimport useRafState from './useRafState';\nimport { isBrowser, off, on } from './misc/util';\nvar useWindowSize = function (initialWidth, initialHeight) {\n    if (initialWidth === void 0) { initialWidth = Infinity; }\n    if (initialHeight === void 0) { initialHeight = Infinity; }\n    var _a = useRafState({\n        width: isBrowser ? window.innerWidth : initialWidth,\n        height: isBrowser ? window.innerHeight : initialHeight,\n    }), state = _a[0], setState = _a[1];\n    useEffect(function () {\n        if (isBrowser) {\n            var handler_1 = function () {\n                setState({\n                    width: window.innerWidth,\n                    height: window.innerHeight,\n                });\n            };\n            on(window, 'resize', handler_1);\n            return function () {\n                off(window, 'resize', handler_1);\n            };\n        }\n    }, []);\n    return state;\n};\nexport default useWindowSize;\n","import { animated, useSpring } from \"@react-spring/web\";\nimport { CSSProperties, HTMLAttributes, forwardRef } from \"react\";\nimport styled from \"styled-components\";\nimport { EStage, configEaseOutStandard } from \"../common\";\nimport { TextButton, TextButtonWrapper } from \"./IconButton\";\n\nexport interface IStagedAnimation {\n  enter: CSSProperties | number;\n  default: CSSProperties | number;\n  exit: CSSProperties | number;\n}\n\nconst defaultContentStyles: IStagedAnimation = {\n  enter: { opacity: 0 },\n  default: { opacity: 1 },\n  exit: { opacity: 0 },\n} as const;\nconst defaultContentDelay: IStagedAnimation = {\n  enter: 0,\n  default: 0,\n  exit: 0,\n} as const;\nconst defaultBackgroundStyles: IStagedAnimation = {\n  enter: { left: \"-100%\", opacity: 0 },\n  default: { left: \"0%\", opacity: 1 },\n  exit: { left: \"-100%\", opacity: 0 },\n} as const;\nconst defaultBackgroundDelay: IStagedAnimation = {\n  enter: 0,\n  default: 0,\n  exit: 0,\n} as const;\n\nexport interface IAnimatedTextButtonProps\n  extends HTMLAttributes<HTMLDivElement> {\n  stage: EStage;\n  icon?: React.ReactNode;\n  background?: string;\n  showText?: boolean;\n  disableBackgroundMotion?: boolean;\n  childrenSprings?: IStagedAnimation;\n  childrenDelays?: IStagedAnimation;\n  backgroundSprings?: IStagedAnimation;\n  backgroundDelays?: IStagedAnimation;\n}\n/**\n *\n * @prop: stage: enter | default | exit, for different stage animation\n * @prop: children: the content to display\n * @example: <AnimatedButton stage=\"enter\">Add System</AnimatedButton>\n */\nexport const AnimatedTextButton = forwardRef<\n  HTMLDivElement,\n  IAnimatedTextButtonProps\n>(\n  (\n    {\n      stage,\n      icon,\n      children,\n      showText,\n      disableBackgroundMotion,\n      background,\n      childrenSprings = defaultContentStyles,\n      childrenDelays = defaultContentDelay,\n      backgroundSprings = defaultBackgroundStyles,\n      backgroundDelays = defaultBackgroundDelay,\n      ...props\n    },\n    ref\n  ) => {\n    const [animation] = useSpring(\n      () => ({\n        from: childrenSprings[\"enter\"],\n        to: childrenSprings[stage],\n        config: configEaseOutStandard,\n        delay: childrenDelays[stage],\n      }),\n      [stage]\n    );\n    const [backgroundAnimation] = useSpring(\n      () => ({\n        from: disableBackgroundMotion\n          ? childrenSprings.default\n          : backgroundSprings[\"enter\"],\n        to: disableBackgroundMotion\n          ? childrenSprings.default\n          : backgroundSprings[stage],\n        config: configEaseOutStandard,\n        delay: backgroundDelays[stage],\n      }),\n      [stage]\n    );\n    return (\n      <TextButton\n        ref={ref}\n        {...props}\n        style={{ ...props.style, overflow: \"hidden\", background: \"none\" }}\n      >\n        <Background style={backgroundAnimation} $background={background} />\n        <Highlight />\n        {icon}\n        {children && (\n          <animated.div\n            style={{ ...(showText ? undefined : animation), zIndex: 1 }}\n          >\n            {children}\n          </animated.div>\n        )}\n      </TextButton>\n    );\n  }\n);\nAnimatedTextButton.displayName = \"AnimatedTextButton\";\n\nconst Background = styled(animated.div)<{ $background?: string }>`\n  ${({ theme }) => theme.absoluteFillCSS}\n  background: ${({ $background, theme }) =>\n    $background ?? theme.colors.plus_cloud};\n  border-radius: 4px;\n  z-index: 0;\n`;\n\nconst Highlight = styled(animated.div)`\n  ${({ theme }) => theme.absoluteFillCSS}\n  background: ${({ theme }) => theme.colors.addHoveredBright};\n  border-radius: 4px;\n  transition: opacity 150ms linear;\n  z-index: 0;\n  opacity: 0;\n\n  ${TextButtonWrapper}:hover & {\n    opacity: 1;\n  }\n`;\n","import { useEffect, useRef } from \"react\";\nimport { useWindowSize } from \"react-use\";\nimport { useDymenuController } from \"../contexts\";\n\n// TODO: refactor with resize observer. Reference: 07.HILDesktop.Dymenu.common\nexport function useDymenuCenter(\n  width: number,\n  height: number,\n  paddingBottom: number = 40\n) {\n  const init = useRef(false);\n  const { width: windowWidth, height: windowHeight } = useWindowSize();\n  const { menuWidth, menuHeight, scaleSizeTo, setSizeTo } =\n    useDymenuController();\n  useEffect(() => {\n    if (init.current) {\n      scaleSizeTo?.({\n        x: windowWidth / 2,\n        y: windowHeight - paddingBottom,\n        width: menuWidth?.get(),\n        height: menuHeight?.get(),\n        config: { delay: 500 },\n      });\n    } else {\n      setSizeTo?.({\n        x: windowWidth / 2,\n        y: windowHeight - paddingBottom,\n        width,\n        height,\n      });\n      init.current = true;\n    }\n  }, [\n    height,\n    init,\n    menuHeight,\n    menuWidth,\n    scaleSizeTo,\n    setSizeTo,\n    width,\n    windowHeight,\n    windowWidth,\n    paddingBottom,\n  ]);\n}\n","import { useState } from \"react\";\nimport { useMount } from \"react-use\";\nimport { Control, DEFAULT_SIZE, GAP, PADDING } from \"../common\";\n\ninterface ISize {\n  width: number;\n  height: number;\n}\ninterface Props {\n  itemRefs: React.MutableRefObject<HTMLElement[]>;\n}\nexport function useAutoSizeHorizontal({ itemRefs }: Props): [ISize, Control[]] {\n  const [size, setSize] = useState<[ISize, Control[]]>([\n    {\n      width: DEFAULT_SIZE,\n      height: DEFAULT_SIZE,\n    },\n    [],\n  ]);\n  useMount(() => {\n    if (itemRefs.current.length === 0) return;\n    let totalWidth = PADDING;\n    let maxHeight = 2 * PADDING;\n    const controls = itemRefs.current.map((item, i) => {\n      const { width, height } = item.getBoundingClientRect();\n      maxHeight = Math.max(height + 2 * PADDING, maxHeight);\n      const res = {\n        x: totalWidth,\n        y: PADDING,\n      };\n      totalWidth += width + GAP;\n      return res;\n    });\n    totalWidth += PADDING - GAP;\n    setSize([\n      {\n        width: totalWidth,\n        height: maxHeight,\n      },\n      controls,\n    ]);\n  });\n  return size;\n}\n","import { useWindowSize } from \"react-use\";\nimport { useDymenuController } from \"../contexts\";\nimport { PADDING } from \"../common\";\nimport { SpringConfig } from \"@react-spring/web\";\n\nexport function useScaleToElement(\n  ref: React.RefObject<HTMLElement>,\n  config?: SpringConfig\n) {\n  const { scaleSizeTo } = useDymenuController();\n  const { width: windowWidth, height: windowHeight } = useWindowSize();\n  return async () => {\n    if (!ref.current) return;\n    const { width, height } = ref.current.getBoundingClientRect();\n    return await scaleSizeTo?.({\n      x: windowWidth / 2,\n      y: windowHeight - 80,\n      width: width + 2 * PADDING,\n      height: height + 2 * PADDING,\n      config: { config },\n    });\n  };\n}\n","import {\n  Children,\n  ReactNode,\n  createContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\nimport { SpringActor } from \"../Actors\";\nimport { DynamicMenu } from \"../Dynamic\";\nimport { Control, DEFAULT_SIZE, EAnimDuration, EStage } from \"../common\";\nimport { AnimatedTextButton } from \"../components/AnimatedTextButton\";\nimport { useDymenuController } from \"../contexts\";\nimport { useAutoSizeHorizontal, useDymenuCenter } from \"../hooks\";\nimport { ThemeEnumType } from \"../types\";\n\ninterface Props {\n  init?: Control;\n  hasPivot?: boolean;\n  handleClickPivot?: () => void;\n  children: ReactNode;\n  theme?: ThemeEnumType;\n}\n/**\n * @deprecated not effective\n */\nexport function DymenuNavigator(props: Props) {\n  return (\n    <DynamicMenu init={props.init} anchor=\"bottom\" theme={props.theme}>\n      <Navigator {...props} />\n    </DynamicMenu>\n  );\n}\n\nfunction Navigator({ init = {}, children, hasPivot, handleClickPivot }: Props) {\n  const [stage, setStage] = useState<EStage>(EStage.enter);\n  const itemRefs = useRef<HTMLElement[]>([]);\n  const { scaleSizeTo } = useDymenuController();\n\n  useDymenuCenter(init.width ?? DEFAULT_SIZE, init.height ?? DEFAULT_SIZE);\n  const [size, actorControls] = useAutoSizeHorizontal({\n    itemRefs,\n  });\n  useEffect(() => {\n    scaleSizeTo?.(size);\n  }, [scaleSizeTo, size]);\n\n  return (\n    <context.Provider value={{ stage, setStage }}>\n      {Children.map(children, (child, i) => (\n        <SpringActor\n          key={i}\n          to={{ ...actorControls[i] }}\n          ref={(div) => div && itemRefs.current.push(div)}\n        >\n          {hasPivot && i === 0 ? (\n            <AnimatedTextButton\n              stage={stage}\n              style={{ padding: 0, maxWidth: \"none\" }}\n              onClick={\n                !!handleClickPivot\n                  ? () => {\n                      setStage(EStage.exit);\n                      setTimeout(() => {\n                        handleClickPivot();\n                      }, EAnimDuration.STANDARD);\n                    }\n                  : undefined\n              }\n            >\n              {child}\n            </AnimatedTextButton>\n          ) : (\n            child\n          )}\n        </SpringActor>\n      ))}\n    </context.Provider>\n  );\n}\n\ninterface Context {\n  stage: EStage;\n  setStage: (stage: EStage) => void;\n}\nconst context = createContext<Context>({\n  stage: EStage.enter,\n  setStage: () => {},\n});\n"],"names":["useWindowSize","initialWidth","initialHeight","_a","useRafState","isBrowser","state","setState","useEffect","handler_1","on","off","useWindowSize$1","defaultContentStyles","defaultContentDelay","defaultBackgroundStyles","defaultBackgroundDelay","AnimatedTextButton","forwardRef","stage","icon","children","showText","disableBackgroundMotion","background","ref","animation","useSpring","childrenSprings","configEaseOutStandard","backgroundAnimation","backgroundSprings","jsxs","TextButton","props","style","jsx","Background","Highlight","styled","animated","theme","absoluteFillCSS","$background","addHoveredBright","useDymenuCenter","width","height","paddingBottom","init","useRef","windowWidth","windowHeight","menuWidth","menuHeight","scaleSizeTo","setSizeTo","useDymenuController","current","x","y","get","config","delay","useAutoSizeHorizontal","itemRefs","size","setSize","useState","DEFAULT_SIZE","useMount","length","totalWidth","PADDING","maxHeight","controls","map","item","i","getBoundingClientRect","Math","max","res","GAP","useScaleToElement","DymenuNavigator","DynamicMenu","Navigator","hasPivot","setStage","EStage","actorControls","context","div","handleClickPivot","setTimeout","EAnimDuration","child","createContext","enter"],"mappings":"mhCAGA,IAAIA,EAAgB,SAAUC,EAAcC,EAAe,CACnDD,IAAiB,SAAUA,EAAe,KAC1CC,IAAkB,SAAUA,EAAgB,KAChD,IAAIC,EAAKC,EAAY,CACjB,MAAOC,EAAY,OAAO,WAAaJ,EACvC,OAAQI,EAAY,OAAO,YAAcH,CACjD,CAAK,EAAGI,EAAQH,EAAG,CAAC,EAAGI,EAAWJ,EAAG,CAAC,EAClCK,OAAAA,EAAAA,UAAU,UAAY,CAClB,GAAIH,EAAW,CACX,IAAII,EAAY,UAAY,CACxBF,EAAS,CACL,MAAO,OAAO,WACd,OAAQ,OAAO,WACnC,CAAiB,CACjB,EACY,OAAAG,EAAG,OAAQ,SAAUD,CAAS,EACvB,UAAY,CACfE,EAAI,OAAQ,SAAUF,CAAS,CAC/C,EAEK,EAAE,CAAE,CAAA,EACEH,CACX,EACA,MAAAM,EAAeZ,ECdfa,GAAA,CAA+C,MAAA,CACtC,QAAA,CAAW,EAAE,QAAA,CACX,QAAA,CAAW,EAAE,KAAA,CAChB,QAAA,CAAW,CACnB,EACAC,GAAA,CAA8C,MAAA,EACrC,QAAA,EACE,KAAA,CAEX,EACAC,GAAA,CAAkD,MAAA,CACzC,KAAA,QAAQ,QAAA,CAAkB,EAAE,QAAA,CAC1B,KAAA,KAAQ,QAAA,CAAe,EAAE,KAAA,CAC5B,KAAA,QAAQ,QAAA,CAAkB,CAClC,EACAC,GAAA,CAAiD,MAAA,EACxC,QAAA,EACE,KAAA,CAEX,EAoBOC,EAAAC,EAAA,WAAA,CAAA,CAKH,MAAAC,EACEA,KAAAA,EACAC,SAAAA,EACAC,SAAAA,EACAC,wBAAAA,EACAC,WAAAA,EACAC,gBAAAA,EAAAA,GACkBX,eAAAA,EAAAA,GACDC,kBAAAA,EAAAA,GACGC,iBAAAA,EAAAA,GACDC,GAAAA,CAErB,EAAAS,IAAA,CAGA,KAAA,CAAAC,CAAA,EAAAC,EAAA,KAAA,CACS,KAAAC,EAAA,MACwB,GAAAA,EAAAT,CAAA,EACJ,OAAAU,EACjBA,MAAAA,EAAAA,CAAAA,CACmB,GAAA,CAAAV,CAAA,CAAA,EAI/B,CAAAW,CAAA,EAAAH,EAAA,KAAA,CACS,KAAAJ,EAAAK,EAAA,QAAAG,EAAA,MAGwB,GAAAR,EAAAK,EAAA,QAAAG,EAAAZ,CAAA,EAGF,OAAAU,EACnBA,MAAAA,EAAAA,CAAAA,CACqB,GAAA,CAAAV,CAAA,CAAA,EAIjC,OAAAa,EAAAA,KAAAC,EAAA,CAAA,IAAAR,EAAA,GAAAS,EAAA,MAAA,CAIW,GAAAA,EAAA,MAAWC,SAAAA,SAAiB,WAAA,MAAsB,EAAA,SAAA,CAEzDC,EAAA,IAAAC,GAAA,CAAA,MAAAP,EAAA,YAAAN,EAAA,EAAgEY,EAAA,IAAAE,GAAA,EAAA,EACtDlB,EACTA,GAAAA,EAAAA,IAAAA,EAAAA,IAAAA,CAAAA,MAAAA,CAGU,GAAAE,EAAA,OAAAI,EAA6BA,OAAAA,CAAoB,EAAA,SAAAL,CAAA,CAAA,CAG1D,CAAA,CAAA,CAIR,CAAA,EAEFJ,EAAAA,YAAAA,qBAEA,MAAAoB,GAAAE,EAAAC,EAAA,GAAA;AAAA,IAAsC,CAAA,CACjC,MAAAC,CAAQ,IAAAA,EAAA;AAAA,gBAAYC,CAAAA,CACR,YAAAC,EAAEA,MAAAA,CAAmB,IAAAA,GAAAF,EAAA,OAAA;AAAA;AAAA;AAAA,EAMtCH,GAAAC,EAAAC,EAAA,GAAA;AAAA,IAAqC,CAAA,CAChC,MAAAC,CAAQ,IAAAA,EAAA;AAAA,gBAAYC,CAAAA,CACR,MAAAD,CAAQ,IAAAA,EAAA,OAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAmBG;AAAAA;AAAAA;AAAAA;;;;;;;;;;;;;;;;yGCxHrC,SAASC,GACdC,EACAC,EACAC,EAAwB,GACxB,CACMC,MAAAA,EAAOC,SAAO,EAAK,EACnB,CAAEJ,MAAOK,EAAaJ,OAAQK,GAAiBpD,EAAc,EAC7D,CAAEqD,UAAAA,EAAWC,WAAAA,EAAYC,YAAAA,EAAaC,UAAAA,GAC1CC,EAAoB,EACtBjD,EAAAA,UAAU,IAAM,CACVyC,EAAKS,QACOH,GAAA,MAAAA,EAAA,CACZI,EAAGR,EAAc,EACjBS,EAAGR,EAAeJ,EAClBF,MAAOO,GAAAA,YAAAA,EAAWQ,MAClBd,OAAQO,GAAAA,YAAAA,EAAYO,MACpBC,OAAQ,CAAEC,MAAO,GAAI,CAAA,IAGXP,GAAA,MAAAA,EAAA,CACVG,EAAGR,EAAc,EACjBS,EAAGR,EAAeJ,EAClBF,MAAAA,EACAC,OAAAA,CAAAA,GAEFE,EAAKS,QAAU,GAEhB,EAAA,CACDX,EACAE,EACAK,EACAD,EACAE,EACAC,EACAV,EACAM,EACAD,EACAH,CAAa,CACd,CACH,CCjCO,SAASgB,GAAsB,CAAEC,SAAAA,CAAgB,EAAuB,CAC7E,KAAM,CAACC,EAAMC,CAAO,EAAIC,WAA6B,CACnD,CACEtB,MAAOuB,EACPtB,OAAQsB,CAAAA,EAEV,CAAA,CAAE,CACH,EACDC,OAAAA,EAAS,IAAM,CACTL,GAAAA,EAASP,QAAQa,SAAW,EAAG,OACnC,IAAIC,EAAaC,EACbC,EAAY,EAAID,EACpB,MAAME,EAAWV,EAASP,QAAQkB,IAAI,CAACC,EAAMC,IAAM,CAC3C,KAAA,CAAEhC,MAAAA,EAAOC,OAAAA,CAAAA,EAAW8B,EAAKE,wBAC/BL,EAAYM,KAAKC,IAAIlC,EAAS,EAAI0B,EAASC,CAAS,EACpD,MAAMQ,EAAM,CACVvB,EAAGa,EACHZ,EAAGa,CAAAA,EAELD,OAAAA,GAAc1B,EAAQqC,EACfD,CAAAA,CACR,EACDV,GAAcC,EAAUU,EACxBhB,EAAQ,CACN,CACErB,MAAO0B,EACPzB,OAAQ2B,CAAAA,EAEVC,CAAQ,CACT,CAAA,CACF,EACMT,CACT,CCtCgBkB,SAAAA,GACd3D,EACAqC,EACA,CACM,KAAA,CAAEP,YAAAA,GAAgBE,EAAoB,EACtC,CAAEX,MAAOK,EAAaJ,OAAQK,GAAiBpD,EAAc,EACnE,MAAO,UAAY,CACjB,GAAI,CAACyB,EAAIiC,QAAS,OACZ,KAAA,CAAEZ,MAAAA,EAAOC,OAAAA,CAAAA,EAAWtB,EAAIiC,QAAQqB,wBACtC,OAAO,MAAMxB,GAAAA,YAAAA,EAAc,CACzBI,EAAGR,EAAc,EACjBS,EAAGR,EAAe,GAClBN,MAAOA,EAAQ,EAAI2B,EACnB1B,OAAQA,EAAS,EAAI0B,EACrBX,OAAQ,CAAEA,OAAAA,CAAO,CAAA,GAClB,CAEL,CCIO,SAAAuB,EAAAnD,EAAA,CACL,OAAAE,EAAAA,IAAAkD,EAAA,CAAA,KAAApD,EAAA,KAAA,OAAA,SAAA,MAAAA,EAAA,MAAA,SAAAE,MAAAmD,GAAA,CAAA,GAAArD,CAAA,CAAA,CAAA,CAAA,CAKF,CAEA,SAAAqD,GAAA,CAAmB,KAAAtC,EAAA,CAAA,EAAU,SAAA5B,EAAGA,SAAAA,EAAUmE,iBAAAA,CAAkC,EAAA,CAC1E,KAAA,CAAArE,EAAAsE,CAAA,EAAArB,EAAAA,SAAAsB,EAAA,KAAA,EACAzB,EAAAf,SAAA,CAAA,CAAA,EACA,CAAM,YAAAK,CAAEA,EAAAA,EAAAA,EAERV,GAAAA,EAAAA,OAAAA,EAAAA,EAAAA,QAAAA,CAAAA,EACA,KAAA,CAAAqB,EAAAyB,CAAA,EAAA3B,GAAA,CAAoD,SAAAC,CAClDA,CAAAA,EAEFzD,OAAAA,EAAAA,UAAAA,IAAAA,CACE+C,GAAAA,MAAAA,EAAAA,EAAkB,EAAA,CAAAA,EAAAW,CAAA,CAAA,EAGpB9B,MAAAwD,GAAA,SAAA,CAAA,MAAA,CAC2B,MAAAzE,EAAEA,SAAAA,CAAOsE,EAAAA,SAAAA,EAAAA,SAAAA,IAAAA,EAAAA,CAAAA,EAAAA,IAAAA,EAAAA,IAAAA,EAAAA,CAAAA,GAAAA,CAIxB,GAAAE,EAAAb,CAAA,CAAoB,EAAA,IAAAe,GAAAA,GAAA5B,EAAA,QAAA,KAAA4B,CAAA,EAAA,SAAAL,GAAAV,IAAA,EAAA1C,EAAA,IAAAnB,EAAA,CAAA,MAAAE,EAAA,MAAA,CAMb,QAAA,EAAW,SAAA,MAAa,EAAA,QAAA2E,EAAA,IAAA,CAIvBL,EAAAA,EAAAA,IAAAA,EACAM,WAAAA,IAAAA,CACED,GAAiB,EAAAE,EAAA,QAAA,CACM,EAAA,OAAA,SAAAC,CAAA,CAAA,EAAAA,GAAAnB,CAAA,CAAA,CAAA,CAAA,CAc/C,CAMA,MAAAc,GAAAM,EAAAA,cAAA,CAAuC,MAAAR,EAAA,MACvBS,SAAAA,IAAAA,CACE,CAClB,CAAA;;;;;;;;;;;;","x_google_ignoreList":[0]}