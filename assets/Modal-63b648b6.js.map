{"version":3,"file":"Modal-63b648b6.js","sources":["../../../paas-library/src/Modal/Modal.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport styled, { keyframes } from \"styled-components\";\nimport { modalPortalID } from \"../Siblings/portalID\";\nimport { Portal } from \"../Siblings\";\n\nexport const defaultDuration = 200;\n\ninterface IModalProps {\n  open?: boolean;\n  /** content */\n  children?: React.ReactNode;\n  /** click function on click background layer */\n  onBGClick?: () => void;\n  /**\n   * cancel background layer\n   * @default false\n   */\n  disableBG?: boolean;\n  /**\n   * which root div will be considered as modal's parent\n   * @default ModalPortalID \"orthogonal-modals\"\n   */\n  portalID?: string;\n  /**\n   * display & dismiss animation duration\n   * @unit million seconds\n   * @default 200\n   */\n  duration?: number;\n  style?: React.CSSProperties;\n  backgroundStyle?: React.CSSProperties;\n  /** replace default bg color (rgba(0, 0, 0, 0.4)) */\n  backgroundColor?: string;\n}\n\n/**\n * @example\n * export function DemoModal() {\n *   const [open, setOpen] = useState(true);\n *   return (\n *     <Modal open={open} onBGClick={setOpen.bind(null, false)}>\n *       <>111</>\n *     </Modal>\n *   );\n * }\n */\nexport function Modal({\n  open,\n  children,\n  onBGClick,\n  disableBG,\n  portalID = modalPortalID,\n  duration = defaultDuration,\n  style,\n  backgroundColor,\n  backgroundStyle,\n}: IModalProps) {\n  const wrapperDomRef = useRef<HTMLDivElement>(null);\n  const { _open, enter, leave } = useModalEffect(\n    !!open,\n    duration,\n    wrapperDomRef.current\n  );\n  if (!_open || !children) return null;\n  return (\n    <Portal id={portalID}>\n      <ModalWrapper\n        ref={wrapperDomRef}\n        enter={enter}\n        leave={leave}\n        duration={duration}\n        style={style}\n      >\n        {!disableBG && (\n          <ModalBG\n            enter={enter}\n            leave={leave}\n            onClick={onBGClick}\n            duration={duration}\n            style={backgroundStyle}\n            backgroundColor={backgroundColor}\n          />\n        )}\n        {attachProps(children, { enter, leave })}\n      </ModalWrapper>\n    </Portal>\n  );\n}\n\nexport const attachProps = (children?: React.ReactNode, props?: object) => {\n  if (!children || !props) return children;\n  if (!React.isValidElement(children)) return children;\n  if (children instanceof Array) {\n    return children.map((child) => React.cloneElement(child, props));\n  }\n  return React.cloneElement(children, props);\n};\n\nexport function useModalEffect(\n  open: boolean,\n  duration = defaultDuration,\n  dom?: HTMLDivElement | null\n) {\n  const [_open, _setOpen] = useState(open);\n  const [_enter, _setEnter] = useState(false);\n  const [_leave, _setLeave] = useState(false);\n  useEffect(() => {\n    if (open) _setOpen(true);\n  }, [open]);\n  useEffect(() => {\n    if (_open && !open) _setLeave(true);\n  }, [open, _open]);\n  useEffect(() => {\n    if (_open) _setEnter(true);\n    if (!_open) _setEnter(false);\n  }, [_open]);\n  useEffect(() => {\n    // leave\n    if (_leave) {\n      if (dom) {\n        Promise.all(\n          dom.getAnimations({ subtree: true }).map((a) => a.finished)\n        ).then(() => {\n          _setOpen(false);\n          _setLeave(false);\n        });\n      } else {\n        const timer = window.setTimeout(() => {\n          _setOpen(false);\n          _setLeave(false);\n        }, duration);\n        return () => clearTimeout(timer);\n      }\n    }\n  }, [_leave, dom, duration]);\n  useEffect(() => {\n    // clear\n    return () => {\n      _setLeave(false);\n      _setOpen(false);\n    };\n  }, []);\n  return {\n    enter: _enter,\n    leave: _leave,\n    _open,\n  };\n}\n\ninterface AnimProps {\n  enter?: boolean;\n  leave?: boolean;\n  duration?: number;\n  backgroundColor?: string;\n}\n\nfunction getAnimBG(p: AnimProps) {\n  if (p.leave) return \"transparent\";\n  if (p.enter) return p.backgroundColor || \"rgba(0, 0, 0, 0.15)\";\n  return \"transparent\";\n}\n\nfunction getAnimOpacity(p: AnimProps) {\n  if (p.leave) return 0;\n  if (p.enter) return 1;\n  return 0;\n}\n\nexport const fadeIn = keyframes`\n  0% { opacity: 0; }\n  100% { opacity: 1; }\n`;\n\nexport const ModalWrapper = styled.div<AnimProps>`\n  ${(p) => p.theme.fixedFill}\n  z-index: ${(p) => p.theme.zIndexes.modal};\n  ${(p) => p.theme.flexCSS.column}\n  ${(p) => p.theme.flexCSS.center}\n  opacity: ${(p) => getAnimOpacity(p)};\n  animation: ${(p) => p.duration}ms ${fadeIn} ease;\n  transition: opacity ${(p) => p.duration}ms ease;\n`;\n\nexport const ModalBG = styled.div<AnimProps>`\n  ${(p) => p.theme.absoluteFillCSS}\n  background-color: ${(p) => getAnimBG(p)};\n  transition: background-color ${(p) => p.duration}ms ease;\n  touch-action: none;\n`;\n"],"names":["defaultDuration","Modal","open","children","onBGClick","disableBG","portalID","modalPortalID","duration","style","backgroundColor","backgroundStyle","wrapperDomRef","useRef","_open","enter","leave","useModalEffect","jsx","Portal","jsxs","ModalWrapper","ModalBG","attachProps","props","React","child","dom","_setOpen","useState","_enter","_setEnter","_leave","_setLeave","useEffect","a","timer","getAnimBG","p","getAnimOpacity","fadeIn","keyframes","styled"],"mappings":"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"}