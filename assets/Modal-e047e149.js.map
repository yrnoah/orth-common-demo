{"version":3,"file":"Modal-e047e149.js","sources":["../../../paas-library/src/Modal/Modal.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport styled, { keyframes } from \"styled-components\";\nimport { modalPortalID } from \"../Siblings/portalID\";\nimport { Portal } from \"../Siblings\";\n\nexport const defaultDuration = 200;\n\ninterface IModalProps {\n  open?: boolean;\n  /** content */\n  children?: React.ReactNode;\n  /** click function on click background layer */\n  onBGClick?: () => void;\n  /**\n   * cancel background layer\n   * @default false\n   */\n  disableBG?: boolean;\n  /**\n   * which root div will be considered as modal's parent\n   * @default ModalPortalID \"orthogonal-modals\"\n   */\n  portalID?: string;\n  /**\n   * display & dismiss animation duration\n   * @unit million seconds\n   * @default 200\n   */\n  duration?: number;\n  style?: React.CSSProperties;\n  backgroundStyle?: React.CSSProperties;\n  /** replace default bg color (rgba(0, 0, 0, 0.4)) */\n  backgroundColor?: string;\n}\n\n/**\n * @example\n * export function DemoModal() {\n *   const [open, setOpen] = useState(true);\n *   return (\n *     <Modal open={open} onBGClick={setOpen.bind(null, false)}>\n *       <>111</>\n *     </Modal>\n *   );\n * }\n */\nexport function Modal({\n  open,\n  children,\n  onBGClick,\n  disableBG,\n  portalID = modalPortalID,\n  duration = defaultDuration,\n  style,\n  backgroundColor,\n  backgroundStyle,\n}: IModalProps) {\n  const wrapperDomRef = useRef<HTMLDivElement>(null);\n  const { _open, enter, leave } = useModalEffect(\n    !!open,\n    duration,\n    wrapperDomRef.current\n  );\n  if (!_open || !children) return null;\n  return (\n    <Portal id={portalID}>\n      <ModalWrapper\n        ref={wrapperDomRef}\n        enter={enter}\n        leave={leave}\n        duration={duration}\n        style={style}\n      >\n        {!disableBG && (\n          <ModalBG\n            enter={enter}\n            leave={leave}\n            onClick={onBGClick}\n            duration={duration}\n            style={backgroundStyle}\n            backgroundColor={backgroundColor}\n          />\n        )}\n        {attachProps(children, { enter, leave })}\n      </ModalWrapper>\n    </Portal>\n  );\n}\n\nexport const attachProps = (children?: React.ReactNode, props?: object) => {\n  if (!children || !props) return children;\n  if (!React.isValidElement(children)) return children;\n  if (children instanceof Array) {\n    return children.map((child) => React.cloneElement(child, props));\n  }\n  return React.cloneElement(children, props);\n};\n\nexport function useModalEffect(\n  open: boolean,\n  duration = defaultDuration,\n  dom?: HTMLDivElement | null\n) {\n  const [_open, _setOpen] = useState(open);\n  const [_enter, _setEnter] = useState(false);\n  const [_leave, _setLeave] = useState(false);\n  useEffect(() => {\n    if (open) _setOpen(true);\n  }, [open]);\n  useEffect(() => {\n    if (_open && !open) _setLeave(true);\n  }, [open, _open]);\n  useEffect(() => {\n    if (_open) _setEnter(true);\n    if (!_open) _setEnter(false);\n  }, [_open]);\n  useEffect(() => {\n    // leave\n    if (_leave) {\n      if (dom) {\n        Promise.all(\n          dom.getAnimations({ subtree: true }).map((a) => a.finished)\n        ).then(() => {\n          _setOpen(false);\n          _setLeave(false);\n        });\n      } else {\n        const timer = window.setTimeout(() => {\n          _setOpen(false);\n          _setLeave(false);\n        }, duration);\n        return () => clearTimeout(timer);\n      }\n    }\n  }, [_leave, dom, duration]);\n  useEffect(() => {\n    // clear\n    return () => {\n      _setLeave(false);\n      _setOpen(false);\n    };\n  }, []);\n  return {\n    enter: _enter,\n    leave: _leave,\n    _open,\n  };\n}\n\ninterface AnimProps {\n  enter?: boolean;\n  leave?: boolean;\n  duration?: number;\n  backgroundColor?: string;\n}\n\nfunction getAnimBG(p: AnimProps) {\n  if (p.leave) return \"transparent\";\n  if (p.enter) return p.backgroundColor || \"rgba(0, 0, 0, 0.15)\";\n  return \"transparent\";\n}\n\nfunction getAnimOpacity(p: AnimProps) {\n  if (p.leave) return 0;\n  if (p.enter) return 1;\n  return 0;\n}\n\nexport const fadeIn = keyframes`\n  0% { opacity: 0; }\n  100% { opacity: 1; }\n`;\n\nexport const ModalWrapper = styled.div<AnimProps>`\n  ${(p) => p.theme.fixedFill}\n  z-index: ${(p) => p.theme.zIndexes.modal};\n  ${(p) => p.theme.flexCSS.column}\n  ${(p) => p.theme.flexCSS.center}\n  opacity: ${(p) => getAnimOpacity(p)};\n  animation: ${(p) => p.duration}ms ${fadeIn} ease;\n  transition: opacity ${(p) => p.duration}ms ease;\n`;\n\nexport const ModalBG = styled.div<AnimProps>`\n  ${(p) => p.theme.absoluteFillCSS}\n  background-color: ${(p) => getAnimBG(p)};\n  transition: background-color ${(p) => p.duration}ms ease;\n  touch-action: none;\n`;\n"],"names":["defaultDuration","Modal","open","children","onBGClick","disableBG","modalPortalID","style","backgroundColor","wrapperDomRef","useRef","_open","enter","leave","jsx","Portal","portalID","jsxs","ModalWrapper","duration","ModalBG","backgroundStyle","attachProps","props","React","child","useModalEffect","dom","_setOpen","useState","_enter","_setEnter","_leave","_setLeave","useEffect","Promise","a","timer","getAnimBG","p","getAnimOpacity","fadeIn","keyframes","styled","div","fixedFill","modal","column","center","absoluteFillCSS"],"mappings":"oNAKO,MAAAA,EAAA,IAyCA,SAAAC,EAAA,CAAe,KAAAC,EACpBA,SAAAA,EACAC,UAAAA,EACAC,UAAAA,EACAC,SAAAA,EAAAA,EACWC,SAAAA,EAAAA,EACAN,MAAAA,EACXO,gBAAAA,EACAC,gBAAAA,CAEW,EAAA,CACX,MAAAC,EAAAC,SAAA,IAAA,EACA,CAAM,MAAAC,EAAEA,MAAAA,EAAOC,MAAAA,CAAOC,EAAAA,EAAAA,CAAAA,CAAAA,EAAAA,EAAAA,EAAAA,OAAAA,EAKtB,MAAA,CAAAF,GAAA,CAAAR,EAAyB,KACzBW,EAAAA,IAAAC,EAAA,CAAA,GAAAC,EAAA,SAAAC,OAAAC,EAAA,CAAA,IAAAT,EAAA,MAAAG,EAAA,MAAAC,EAAA,SAAAM,EAAA,MAAAZ,EAAA,SAAA,CASO,CAAAF,GAAAS,EAAA,IAAAM,EAAA,CAAA,MAAAR,EAAA,MAAAC,EAAA,QAAAT,EAAA,SAAAe,EAAA,MAAAE,EAAA,gBAAAb,CAAA,CAAA,EASAc,EAAAnB,EAAA,CACsB,MAAAS,EAAEA,MAAAA,CAAOC,CAAAA,CAAO,CAAA,CAAA,CAAA,CAAA,CAI/C,CAEO,MAAAS,EAAA,CAAAnB,EAAAoB,IACL,CAAApB,GAAA,CAAAoB,GACA,CAAAC,EAAA,eAAArB,CAAA,EAAqCA,EACrCA,aAAA,MACEA,EAAA,IAAAsB,GAAAD,EAAA,aAAAC,EAAAF,CAAA,CAAA,EAEFC,EAAA,aAAArB,EAAAoB,CAAA,EAGK,SAAAG,EAAAxB,EAAAiB,EAAAnB,EAAA2B,EAAA,CAKL,KAAA,CAAAhB,EAAAiB,CAAA,EAAAC,EAAA,SAAA3B,CAAA,EACA,CAAA4B,EAAAC,CAAA,EAAAF,EAAA,SAAA,EAAA,EACA,CAAAG,EAAAC,CAAA,EAAAJ,EAAA,SAAA,EAAA,EACAK,OAAAA,EAAAA,UAAAA,IAAAA,CACEhC,GAAU0B,EAAAA,EAAAA,CAAa,EAAA,CAAA1B,CAAA,CAAA,EAEzBgC,EAAAA,UAAAA,IAAAA,CACEvB,GAAA,CAAAT,GAAoB+B,EAAAA,EAAAA,CAAc,EAAA,CAAA/B,EAAAS,CAAA,CAAA,EAEpCuB,EAAAA,UAAAA,IAAAA,CACEvB,GAAWoB,EAAAA,EAAAA,EACXpB,GAAYoB,EAAAA,EAAAA,CAAe,EAAA,CAAApB,CAAA,CAAA,EAE7BuB,EAAAA,UAAAA,IAAAA,CAEE,GAAAF,EACE,GAAAL,EACEQ,QAAAA,IAAAA,EAAAA,cAAAA,CACoB,QAAA,EAAW,CAAA,EAAA,IAAAC,GAAAA,EAAA,QAAA,CAAA,EAAA,KAAA,IAAA,CAE7BR,EAAAA,EAAAA,EACAK,EAAAA,EAAAA,CAAe,CAAA,MAChB,CAED,MAAAI,EAAA,OAAA,WAAA,IAAA,CACET,EAAAA,EAAAA,EACAK,EAAAA,EAAAA,CAAe,EAAAd,CAAA,EAEjB,MAAA,IAAA,aAAAkB,CAAA,EAEJ,EAAA,CAAAL,EAAAL,EAAAR,CAAA,CAAA,EAEFe,EAAAA,UAAAA,IAEE,IAAA,CACED,EAAAA,EAAAA,EACAL,EAAAA,EAAAA,CAAc,EAChB,CAAA,CAAA,EAEF,CAAO,MAAAE,EACEA,MAAAA,EACAE,MAAAA,CACPrB,CAEJ,CASA,SAAA2B,EAAAC,EAAA,CACE,OAAAA,EAAA,MAAa,cACbA,EAAA,MAAaA,EAAA,iBAAA,sBACb,aACF,CAEA,SAAAC,EAAAD,EAAA,CACE,OAAAA,EAAA,MAAa,EACbA,EAAA,MAAa,EACb,CACF,CAEO,MAAAE,EAAAC;AAAAA;AAAAA;AAAAA,EAKAxB,EAAAyB,EAAA;AAAA,IAA4BC,GAAAA,EAAAA,MAAAA;AAAAA,aAChBC,GAAAA,EAAAA,MAAAA,SAAAA;AAAAA,IACkBC,GAAAA,EAAAA,MAAAA,QAAAA;AAAAA,IACVC,GAAAA,EAAAA,MAAAA,QAAAA;AAAAA,aACAC,GAAAA,EAAAA,CAAAA;AAAAA,eACST,GAAAA,EAAA,cAAAE;AAAA,wBACEA,GAAAA,EAAAA;AAAAA,EAI/BrB,EAAAuB,EAAA;AAAA,IAAuBC,GAAAA,EAAAA,MAAAA;AAAAA,sBACXK,GAAAA,EAAAA,CAAAA;AAAAA,iCACqBV,GAAAA,EAAA;AAAA;AAAA;"}