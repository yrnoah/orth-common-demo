{"version":3,"file":"SelectionMenu.stories-a8a6ac2a.js","sources":["../../../paas-library/src/Dropdown/Selection/SelectMenu.tsx"],"sourcesContent":["import { useCallback, useMemo, useState } from \"react\";\nimport { SelectionTrigger } from \"./Trigger\";\nimport { BaseDropdown } from \"../Dropdown\";\nimport { fixedForwardRef } from \"../../utils/component\";\nimport { type BaseOption, type SelectMenuProps } from \"./types\";\nimport { defaultHeight, defaultWidth, defaultRect, bindRef } from \"./common\";\nimport { Overlay } from \"./Overlay\";\n\n/**\n * @note for generic type usage, if need to use ref, please import fixedForwardRef from utils/components and `const SelectMenu = fixedForwardRef(RawSelectMenu);`\n * @description design https://www.figma.com/design/JGFHYME2p7RpeMYcoMqooS/ODE-Library-1.0?node-id=8806-5741&t=a5kq8b0LVuQVrQrr-4\n */\nexport const SelectMenu = <TOption extends BaseOption>(\n  props: SelectMenuProps<TOption>,\n  ref: React.ForwardedRef<HTMLButtonElement>\n) => {\n  const {\n    defaultOpen,\n    dropdownConfig,\n    onSelect,\n    options,\n    selected,\n    resetText,\n    _ref,\n    ...triggerProps\n  } = props;\n  const [triggerRect, setRect] = useState(defaultRect);\n  const [_open, setOpen] = useState(() => !!defaultOpen);\n  const [_selected, setInnerSelected] = useState<string | null>(() => {\n    if (selected && options) {\n      if (options.find((o) => o.key === selected)) return selected;\n      // option not found;\n    }\n    return null;\n  });\n  const currentSelected = typeof selected === \"string\" ? selected : _selected;\n  const selectedItem = useMemo(() => {\n    if (typeof currentSelected !== \"string\") return null;\n    if (!options) return null;\n    const _item = options.find((o) => o.key === currentSelected);\n    return _item || null;\n  }, [currentSelected, options]);\n  const overlayContainerStyle = useMemo(\n    () => ({\n      ...(dropdownConfig?.overlayContainerStyle || {}),\n      width: triggerRect.width,\n    }),\n    [triggerRect.width, dropdownConfig?.overlayContainerStyle]\n  );\n  const onVisibleChange = useCallback((v: boolean) => setOpen(v), []);\n  const onTriggerClick = useCallback(() => {\n    if (triggerProps.disabled) return;\n    setOpen((pre) => !pre);\n  }, [triggerProps.disabled]);\n  const disabled = !!triggerProps.disabled;\n  const onOptionSelect = useCallback(\n    (item: unknown) => {\n      setOpen(false);\n      if (disabled) return;\n      // reset\n      if (!item) {\n        if (onSelect) onSelect(null);\n        setInnerSelected(null);\n        return;\n      }\n      const _target = item as TOption;\n      // equal to current\n      if (_target.key === currentSelected) return;\n      // select\n      if (onSelect) onSelect(_target);\n      setInnerSelected(_target.key);\n    },\n    [onSelect, disabled, currentSelected]\n  );\n  return (\n    <BaseDropdown\n      disableAnimation\n      {...dropdownConfig}\n      visible={_open}\n      overlayContainerStyle={overlayContainerStyle}\n      onVisibleChange={onVisibleChange}\n      overlay={\n        <Overlay\n          options={options}\n          disabled={disabled}\n          onSelect={onOptionSelect}\n          selected={currentSelected}\n          resetText={resetText}\n          visible={_open}\n        />\n      }\n    >\n      <SelectionTrigger\n        {...triggerProps}\n        $open={_open}\n        onClick={onTriggerClick}\n        $text={\n          selectedItem?.text ??\n          selectedItem?.key ??\n          currentSelected ??\n          selected ??\n          undefined\n        }\n        ref={(element) => {\n          if (!element) return;\n          const rect = element.getBoundingClientRect();\n          const to = {\n            width: rect.width || defaultWidth,\n            height: rect.height || defaultHeight,\n          };\n          if (\n            to.width !== triggerRect.width ||\n            to.height !== triggerRect.height\n          ) {\n            setRect(to);\n          }\n          bindRef(element, _ref);\n          bindRef(element, ref);\n        }}\n      />\n    </BaseDropdown>\n  );\n};\n\nexport const SelectMenuWithRef = fixedForwardRef(SelectMenu);\n"],"names":["SelectMenu","props","ref","defaultOpen","dropdownConfig","onSelect","options","selected","resetText","_ref","triggerProps","triggerRect","setRect","useState","defaultRect","_open","setOpen","_selected","setInnerSelected","o","currentSelected","selectedItem","useMemo","overlayContainerStyle","onVisibleChange","useCallback","v","onTriggerClick","pre","disabled","onOptionSelect","item","_target","jsx","BaseDropdown","Overlay","SelectionTrigger","element","rect","to","defaultWidth","defaultHeight","bindRef","SelectMenuWithRef","fixedForwardRef"],"mappings":"8mBAYO,MAAAA,EAAA,CAAAC,EAAAC,IAAA,CAIL,KAAA,CAAM,YAAAC,EACJ,eAAAC,EACA,SAAAC,EACA,QAAAC,EACA,SAAAC,EACA,UAAAC,EACA,KAAAC,EACA,GAAAC,CACG,EAAAT,EAEL,CAAAU,EAAAC,CAAA,EAAAC,EAAA,SAAAC,CAAA,EACA,CAAAC,EAAAC,CAAA,EAAAH,EAAA,SAAA,IAAA,CAAA,CAAAV,CAAA,EACA,CAAAc,EAAAC,CAAA,EAAAL,EAAA,SAAA,IACEN,GAAAD,GACEA,EAAA,KAAAa,GAAAA,EAAA,MAAAZ,CAAA,EAA6CA,EAG/C,IAAO,EAETa,EAAA,OAAAb,GAAA,SAAAA,EAAAU,EACAI,EAAAC,EAAAA,QAAA,IACE,OAAAF,GAAA,UACA,CAAAd,EAAc,KACdA,EAAA,KAAAa,GAAAA,EAAA,MAAAC,CAAA,GACA,KAAgB,CAAAA,EAAAd,CAAA,CAAA,EAElBiB,EAAAD,EAAA,QAA8B,KAAA,CACrB,IAAAlB,GAAA,YAAAA,EAAA,wBAAA,CAAA,EACyC,MAAAO,EAAA,KAC3B,GACrB,CAAAA,EAAA,MAAAP,GAAA,YAAAA,EAAA,qBAAA,CACyD,EAE3DoB,EAAAC,EAAAA,YAAAC,GAAAV,EAAAU,CAAA,EAAA,CAAA,CAAA,EACAC,EAAAF,EAAAA,YAAA,IAAA,CACEf,EAAA,UACAM,EAAAY,GAAA,CAAAA,CAAA,CAAqB,EAAA,CAAAlB,EAAA,QAAA,CAAA,EAEvBmB,EAAA,CAAA,CAAAnB,EAAA,SACAoB,EAAAL,EAAA,YAAuBM,GAAA,CAGnB,GADAf,EAAA,EAAA,EACAa,EAAc,OAEd,GAAA,CAAAE,EAAA,CACE1B,GAAcA,EAAA,IAAA,EACda,EAAA,IAAA,EACA,OAEF,MAAAc,EAAAD,EAEAC,EAAA,MAAAZ,IAEAf,GAAcA,EAAA2B,CAAA,EACdd,EAAAc,EAAA,GAAA,EAA4B,EAC9B,CAAA3B,EAAAwB,EAAAT,CAAA,CACoC,EAEtC,OAAAa,EACEC,EAAC,CAAA,iBAAA,GACiB,GAAA9B,EACZ,QAAAW,EACK,sBAAAQ,EACT,gBAAAC,EACA,QAAAS,EAEEE,EAAC,CAAA,QAAA7B,EACC,SAAAuB,EACA,SAAAC,EACU,SAAAV,EACA,UAAAZ,EACV,QAAAO,CACS,CAAA,EACX,SAAAkB,EAGFG,EAAC,CAAA,GAAA1B,EACK,MAAAK,EACG,QAAAY,EACE,OAAAN,GAAA,YAAAA,EAAA,QAAAA,GAAA,YAAAA,EAAA,MAAAD,GAAAb,GAAA,OAMP,IAAA8B,GAAA,CAGA,GAAA,CAAAA,EAAc,OACd,MAAAC,EAAAD,EAAA,wBACAE,EAAA,CAAW,MAAAD,EAAA,OAAAE,EACY,OAAAF,EAAA,QAAAG,CACE,GAEzBF,EAAA,QAAA5B,EAAA,OAAA4B,EAAA,SAAA5B,EAAA,SAIEC,EAAA2B,CAAA,EAEFG,EAAAL,EAAA5B,CAAA,EACAiC,EAAAL,EAAAnC,CAAA,CAAoB,CACtB,CAAA,CACF,CAAA,CAGN,EAEOyC,EAAAC,EAAA5C,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;"}