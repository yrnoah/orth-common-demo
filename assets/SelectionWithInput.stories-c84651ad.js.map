{"version":3,"file":"SelectionWithInput.stories-c84651ad.js","sources":["../../../paas-library/src/Dropdown/Selection/SelectFilterInput.tsx"],"sourcesContent":["import { useCallback, useMemo, useState } from \"react\";\nimport { fixedForwardRef } from \"../../utils/component\";\nimport { isKeyEnter } from \"../../utils/keyCode\";\nimport { BaseDropdown } from \"../Dropdown\";\nimport { bindRef, defaultHeight, defaultRect, defaultWidth } from \"./common\";\nimport { Overlay } from \"./Overlay\";\nimport { Input, Trigger, TriggerIcon } from \"./Trigger\";\nimport { type BaseOption, type SelectMenuProps } from \"./types\";\nimport styled from \"styled-components\";\n\ntype SelectFilterInputProps<TOption extends BaseOption> = Omit<\n  SelectMenuProps<TOption>,\n  \"onSelect\"\n> & {\n  inputProps?: Omit<\n    React.ComponentPropsWithRef<\"input\">,\n    \"value\" | \"defaultValue\" | \"autoFocus\" | \"onChange\"\n  >;\n  onSelectChange?: (\n    item: TOption | null | string,\n    type: \"select\" | \"input\"\n  ) => void;\n};\n\n/** @design https://www.figma.com/design/6Cm9Jlra5K0OXKSZNRKOhI/Studio-Apps-%7C-ODE-1.1.0-%5B24Q3%5D?node-id=7550-37679&t=LDWGOkSu6EGbzLFX-4 */\nexport const SelectFilterInput = <TOption extends BaseOption>(\n  props: SelectFilterInputProps<TOption>,\n  ref: React.ForwardedRef<HTMLButtonElement>\n) => {\n  const {\n    defaultOpen,\n    dropdownConfig,\n    onSelectChange,\n    options,\n    selected,\n    resetText,\n    _ref,\n    inputProps,\n    ...triggerProps\n  } = props;\n  const [triggerRect, setRect] = useState(defaultRect);\n  const [_open, setOpen] = useState(() => !!defaultOpen);\n  const [inputFocused, setInputFocused] = useState(false);\n  const [_selected, setInnerSelected] = useState<string | null>(\n    selected || null\n  );\n  const currentSelected = typeof selected === \"string\" ? selected : _selected;\n  const selectedItem = useMemo(() => {\n    if (typeof currentSelected !== \"string\") return null;\n    if (!options) return null;\n    const _item = options.find((o) => o.key === currentSelected);\n    return _item || null;\n  }, [currentSelected, options]);\n  const _options = useMemo(() => {\n    if (!options) return [];\n    if (!inputFocused) return options;\n    if (!!currentSelected?.length) {\n      return options.filter((o) => {\n        if (o.key.match(currentSelected)) return true;\n        if (\n          o.text &&\n          o.text.toLowerCase().match(currentSelected.toLowerCase())\n        ) {\n          return true;\n        }\n        return false;\n      });\n    }\n    return options;\n  }, [options, inputFocused, currentSelected]);\n  const overlayContainerStyle = useMemo(\n    () => ({\n      ...(dropdownConfig?.overlayContainerStyle || {}),\n      width: triggerRect.width,\n    }),\n    [triggerRect.width, dropdownConfig?.overlayContainerStyle]\n  );\n  const onVisibleChange = (v: boolean) => {\n    if (!v) {\n      onSelectChange?.(_selected, \"select\");\n      setInputFocused(false);\n    }\n    setOpen(v);\n  };\n  const onTriggerClick = useCallback(\n    (e: React.MouseEvent) => {\n      if ((e.target as Element).tagName === \"INPUT\") return;\n      if (triggerProps.disabled) return;\n      setOpen((pre) => !pre);\n    },\n    [triggerProps.disabled]\n  );\n  const disabled = !!triggerProps.disabled;\n  const onOptionSelect = useCallback(\n    (item: unknown) => {\n      if (disabled) return;\n      // reset\n      if (!item) {\n        setInnerSelected(null);\n        setOpen(false);\n        return;\n      }\n      const _target = item as TOption;\n      // equal to current\n      if (_target.key === currentSelected) return;\n      // select\n      setInnerSelected(_target.key);\n      setOpen(false);\n    },\n    [disabled, currentSelected]\n  );\n  let $text =\n    selectedItem?.text ??\n    selectedItem?.key ??\n    currentSelected ??\n    selected ??\n    undefined;\n  /** @description position will break component with div wrapper */\n  if (triggerProps.style?.position) delete triggerProps.style?.position;\n\n  return (\n    <BaseDropdown\n      disableAnimation\n      {...dropdownConfig}\n      visible={_open}\n      overlayContainerStyle={overlayContainerStyle}\n      onVisibleChange={onVisibleChange}\n      overlay={\n        <Overlay\n          options={_options}\n          disabled={disabled}\n          onSelect={onOptionSelect}\n          selected={currentSelected}\n          resetText={resetText}\n          visible={_open}\n        />\n      }\n    >\n      <Container $width={triggerProps.style?.width}>\n        <TriggerButton\n          {...triggerProps}\n          $open={_open}\n          onClick={onTriggerClick}\n          ref={(element) => {\n            if (!element) return;\n            const rect = element.getBoundingClientRect();\n            const to = {\n              width: rect.width || defaultWidth,\n              height: rect.height || defaultHeight,\n            };\n            if (\n              to.width !== triggerRect.width ||\n              to.height !== triggerRect.height\n            ) {\n              setRect(to);\n            }\n            bindRef(element, _ref);\n            bindRef(element, ref);\n          }}\n        >\n          <TriggerIcon />\n        </TriggerButton>\n        <Input\n          {...inputProps}\n          disabled={triggerProps.disabled || inputProps?.disabled}\n          readOnly={triggerProps.disabled || inputProps?.readOnly}\n          type=\"text\"\n          value={_open ? currentSelected || \"\" : $text || \"\"}\n          placeholder={triggerProps.$placeholder}\n          onFocus={(e) => {\n            inputProps?.onFocus?.(e);\n            setInputFocused(true);\n            setOpen(true);\n          }}\n          onChange={(e) => {\n            const inputValue = e.target.value || \"\";\n            if (onSelectChange) onSelectChange(inputValue || null, \"input\");\n            setInnerSelected(inputValue || null);\n          }}\n          onKeyDown={(e) => {\n            inputProps?.onKeyDown?.(e);\n            if (isKeyEnter(e)) {\n              e.currentTarget.blur();\n              setOpen(false);\n              setInputFocused(false);\n            }\n          }}\n        />\n      </Container>\n    </BaseDropdown>\n  );\n};\n\nexport const SelectFilterInputWithRef = fixedForwardRef(SelectFilterInput);\n\nconst TriggerButton = styled(Trigger)`\n  width: 100%;\n`;\n\nconst Container = styled.div<{ $width: React.CSSProperties[\"width\"] }>`\n  position: relative;\n  width: 100%;\n\n  ${({ $width }) => ($width ? { width: $width } : undefined)}\n`;\n"],"names":["SelectFilterInput","props","ref","defaultOpen","dropdownConfig","onSelectChange","options","selected","resetText","_ref","inputProps","triggerProps","triggerRect","setRect","useState","defaultRect","_open","setOpen","inputFocused","setInputFocused","_selected","setInnerSelected","currentSelected","selectedItem","useMemo","o","_options","overlayContainerStyle","width","onVisibleChange","v","onTriggerClick","useCallback","e","disabled","onOptionSelect","item","_target","$text","_a","_b","jsx","BaseDropdown","Overlay","jsxs","Container","_c","TriggerButton","element","rect","to","defaultWidth","defaultHeight","bindRef","TriggerIcon","Input","inputValue","isKeyEnter","SelectFilterInputWithRef","fixedForwardRef","styled","Trigger","div","$width"],"mappings":"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"}